(window.webpackJsonpvegareader=window.webpackJsonpvegareader||[]).push([[31],{1506:function(e,t,a){"use strict";a.r(t);var n=a(9),r=a(10),i=a(27),o=a(26),g=a(0),u=a.n(g),s=a(13),l=a.n(s),c=a(16),p=a(176),P=a(44),d=a(136),f=a(6),m=a(293),v=a(8),h=a(1),b=h.wb,N=h.Ab,k=h.kb,C=h.jb,w=function(e){var t,a=e.bookmarkData,n=e.classes,r=e.isFirstPage,i=e.isLastPage,o=e.isYoungLearner,g=e.leftPanel,s=e.nextTitle,l=e.onBlur,c=e.onChange,p=e.onFocus,m=e.onKeyDown,v=e.prevTitle,b=e.showBookmark,N=e.showGoToPage,k=e.onPageRequestCallback,C=e.value,w=g.drawerState,x=g.drawerSelectedPanel,S=g.isOpen,T=Object(f.default)("vega-reader-footer",(t={},Object(P.a)(t,n.vegaFooter,!o),Object(P.a)(t,n.vegaFooterShift,S),Object(P.a)(t,n.vegaFooterMinimizePanelShift,x===h.Q||x===h.M&&w===h.Y),Object(P.a)(t,n.vegaFooterHiddenMenu,w===h.Z),t));return u.a.createElement("div",{className:T},u.a.createElement(d.PrintPageComponent,{bookmarkData:a,isFirstPage:r,isLastPage:i,isYoungLearner:o,nextTitle:s,onBlur:l,onChange:c,onFocus:p,onKeyDown:m,prevTitle:v,showBookmark:b,showGoToPage:N,onPageRequestCallback:k,value:C,leftPanel:g}))};w.defaultProps={bookmarkData:{},isFirstPage:!1,isLastPage:!1,isYoungLearner:!1,leftPanel:{},nextTitle:"",onBlur:function(){},onChange:function(){},onFocus:function(){},onKeyDown:function(){},prevTitle:"",showBookmark:!0,showGoToPage:!1,onPageRequestCallback:function(){},value:"-"};var x=Object(m.a)(Object(v.a)((function(e){return{vegaFooter:{width:"calc(100% - ".concat(94,"px)"),transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.easeIn,duration:e.transitions.duration.leavingScreen})},vegaFooterHiddenMenu:{width:"100%"},vegaFooterShift:{width:"calc(100% - ".concat(parseInt(b,10),"px)"),marginLeft:"".concat(b,"px"),transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen})},vegaFooterMinimizePanelShift:{width:"calc(100% - ".concat(parseInt(N,10),"px)"),marginLeft:"".concat(N,"px")},filmstripFooterShift:{width:"calc(100% - ".concat(k,"px)"),marginLeft:"".concat(k,"px"),transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen})},filmstripExpandFooterShift:{width:"calc(100% - ".concat(C,"px)"),marginLeft:"".concat(C,"px"),transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen})}}}))(w)),S=function(e){Object(i.a)(a,e);var t=Object(o.a)(a);function a(e){var r;return Object(n.a)(this,a),(r=t.call(this,e)).fetchPrintPageData=function(e){var t=r.props,a=t.isMultiplePrintPageNoAvailable,n=t.isPxeContent,i=t.printPageNumberPlugin,o=r.state.printPageValue;i.getPrintPageIds((function(t){if(t.children){var g=i.handlePageNumbersList(t.children);if(r.pageNumberMappingData=g,i.setPageNumberData(g),r.updatePrintPageNumber(o),e&&a){var u=window;if(n){var s=document.querySelector(".vega-reader-content"),l=s&&s.getElementsByTagName("iframe")[0];u=l&&(l.contentWindow||l.contentDocument)}r.onPageBreaksLoaded(u,n)}r.setState({showGoToPage:!0})}}))},r.updatePrintPageNumber=function(){if(!r.props.isMultiplePrintPageNoAvailable){var e,t=r.props,a=t.currentPageId,n=t.isDoublePage,i=t.pagePlaylist,o=r.determinePageIndex(a),g="-";if(g=o>=0?r.pageNumberMappingData[o].pageNumbers[0].pageNumber:g.split("|")[0].trim(),n){var u=i[r.getCurrentPageIndex(a)+1];u&&(e=r.determinePageIndex(u.id))>=0&&(g="".concat(g," | ").concat(r.pageNumberMappingData[e].pageNumbers[0].pageNumber))}r.setState({printPageValue:g,prevPrintPageNumber:g})}},r.onPageBreaksLoaded=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window,t=arguments.length>1?arguments[1]:void 0;try{var a,n=r.props,i=n.currentPageId,o=n.pagePlaylist,g=e&&e.document.getElementsByClassName("pageNumberBlock"),u="-",s=r.getCurrentPageIndex(i),l=null===(a=o[s-1])||void 0===a?void 0:a.id;if(g.length>0){var c=0,p=window.innerHeight-(t?117:80),P=r.determinePageIndex(i);if(P>=0){var d=r.pageNumberMappingData[P].pageNumbers;Object.keys(g).forEach((function(e){var t=g[e].getBoundingClientRect();d.some((function(t){return t.pageNumber===g[e].innerText}))&&p>t.top&&t.top>c&&(u=g[e].innerText),c=t.top})),"-"===u&&(c=0,d.length>0&&Object.keys(g).forEach((function(e){var t=g[e].getBoundingClientRect();d.some((function(t){return t.pageNumber===g[e].innerText}))&&t.top<0&&t.top<c&&(u=g[e].innerText),c=t.top})),"-"===u&&(u=r.getPreviousPageNumber(l)))}else u=r.getPreviousPageNumber(l)}else u=r.getPreviousPageNumber(l);r.setState({printPageValue:u,prevPrintPageNumber:u})}catch(e){console.log("onPageBreaksLoaded error",e)}},r.getCurrentPage=function(e){return r.props.pagePlaylist.find((function(t){return t.id===e}))},r.getCurrentPageIndex=function(e){return r.props.pagePlaylist.findIndex((function(t){return t.id===e}))},r.getPreviousPageNumber=function(e){var t="-";if(e){var a=r.props.pagePlaylist,n=r.getCurrentPageIndex(e),i=r.determinePageIndex(e);if(i>=0){var o=r.pageNumberMappingData[i].pageNumbers;if(o&&o.length>0&&(t=o[o.length-1].pageNumber),"-"===t){var g,u=null===(g=a[n-1])||void 0===g?void 0:g.id;t=r.getPreviousPageNumber(u)}}else if("-"===t){var s,l=null===(s=a[n-1])||void 0===s?void 0:s.id;t=r.getPreviousPageNumber(l)}}return t},r.getClosestPageNumber=function(e,t,a){var n=parseInt(e,10),i=r.pageNumberMappingData;if(t<n)return r.navigatePage(!0,!0),"navToLastPage";if(n<a)return r.navigatePage(!1,!0),"navToFirstPage";if(t>n&&n>a&&!isNaN(n)){var o=[],g=[],u=[];i.forEach((function(e){e.pageNumbers.forEach((function(e){var t=parseInt(e.pageNumber,10);t&&o.push(t)}))})),o.forEach((function(e){e<n&&g.push(e),e>n&&u.push(e)}));var s=u[0],l=g[g.length-1];if(l>=0&&s>=0)return String(n-l<s-n?l:s);if(l>=0&&!(s>=0))return String(l);if(!(l>=0)&&s>=0)return String(s)}return""},r.determinePageIndex=function(e){var t=r.props.isPdfContent,a=e,n=-1;try{var i=r.getCurrentPage(a),o=i.href,g=i._id;i.href.includes("#")&&(o=i.href.split("#")[0]),t&&(a=g),(n=r.pageNumberMappingData.findIndex((function(e){return e.containerContentUrn===a})))<0&&(n=r.pageNumberMappingData.findIndex((function(e){return e.pageUri===o})))}catch(e){console.log("determinePageIndex error",e)}return n},r.onPageClick=function(e,t){var a=r.props.printPageNumberPlugin;a.viewerContext.paraIdentifier="",a.viewerContext.postRanges=[],r.navigatePage(t),e.currentTarget.blur()},r.navigatePage=function(e){var t,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=r.props,i=n.currentPageId,o=n.isDoublePage,g=n.isPdfContent,u=n.onPageRequest,s=n.pageNumbers,l=n.pagePlaylist;if(a)if(s.setBackMatterNavLink(""),e){if(t=l[l.length-1],g&&o){var p=r.getCurrentPageDetails(t.pagenumber);t=l.find((function(e){return e.pagenumber===p}))}}else t=l[0];else{var P=r.getCurrentPageIndex(i),d=o?2:1;if(s.setBackMatterNavLink(""),e?P+=d:P-=d,P<0||P>=l.length)return;t=l[P]}u(t,e),window.scroll(0,0),c.EventProvider.getEventManager().dispatch({category:"Navigation",action:e?"Next":"Prev",data:{pageRequested:t}})},r.goToPage=function(e){var t=r.props,a=t.currentPageId,n=t.goToPrintPageCallback,i=t.isPdfContent,o=t.isDoublePage,g=t.onPageRequest,u=t.pagePlaylist,s=r.state.prevPrintPageNumber,l=r.pageNumberMappingData;if(13===e.keyCode&&""!==e.target.value){var c=e.target.value.trim(),p=c;if(i&&o){p=(c=c.split("|"))[0].trim();var P=r.getCurrentPage(a).pagenumber;if(c.length>1&&P===p||"-"===p){var d=c[1].trim(),f=u[r.getCurrentPageIndex(a)+1];(null==f?void 0:f.pagenumber)!==d&&(p=c[1].trim())}var m=r.getCurrentPageDetails(p);p=""===m?p:m}if(l.length){if(!r.handleGoToPage(p,l,i,g,a)){var v=-1,h=null;if(0!==l.length){l.forEach((function(e){0!==e.pageNumbers.length&&e.pageNumbers.forEach((function(e){var t=parseInt(e.pageNumber,10);t&&t>=0&&!isNaN(t)&&(v=v<t?t:v,h=h&&h<t?h:t)}))}));var b=r.getClosestPageNumber(p,v,h);b?(r.handleGoToPage(b,l,i,g,a),r.setState({printPageValue:s}),n("closestPage")):(r.setState({printPageValue:s}),n("noPage"))}else r.setState({printPageValue:s}),n("noPage")}}e.preventDefault()}},r.handleChange=function(e){r.setState({printPageValue:e.target.value})},r.handleGoToPage=function(e,t,a,n,i){var o=!1;return t.forEach((function(t){var g=t.pageNumbers.findIndex((function(t){return e.toLowerCase()===t.pageNumber.toLowerCase()}));if(g>=0){o=!0;var u=t.pageNumbers[g].elementContentUrn,s=t.pageNumbers[g].pageNumber;if(a&&i!==s)r.setState({prevPrintPageNumber:e}),n({chapterId:t.containerContentUrn,pagenumber:s,uri:t.pageUri,href:t.pageUri,id:t.playOrder,scrollToParent:u,title:t.unformattedTitle,playOrder:t.playOrder});else if(!a)if(i!==t.containerContentUrn)r.pageNo=e,r.setState({prevPrintPageNumber:e}),n({uri:t.containerContentUrn,id:t.containerContentUrn,scrollToParent:u,title:t.unformattedTitle,pageNumberIndex:g});else{var l=document.querySelectorAll('[data-contenturn="'.concat(u,'"],[data-uri="').concat(u,'"]')),c=document.querySelector(".vega-reader-content"),p=document.getElementsByClassName("vega-reader-content")[0].getElementsByTagName("iframe")[0];if(l&&l.length>0&&c)c.scrollTo(0,l[0].offsetTop-35);else if(p&&p.contentWindow){var P=p.contentWindow.document.querySelectorAll('[data-contenturn="'.concat(u,'"],[data-uri="').concat(u,'"]'));P[0]&&p.contentWindow.scrollTo(0,P[0].offsetTop-35)}}}})),o},r.getCurrentPageDetails=function(e){var t=r.props.pagePlaylist,a=t.findIndex((function(t){return e===t.pagenumber})),n=a%2==0?t[a]:t[a-1];return n?n.pagenumber:""},r.handleFocus=function(){var e=r.state.printPageValue;r.setState({prevPrintPageNumber:e})},r.handleBlur=function(e){var t=r.state,a=t.printPageValue,n=t.prevPrintPageNumber;""===a&&r.setState({printPageValue:n}),e.preventDefault()},r.state={prevPrintPageNumber:"-",printPageValue:"-",showGoToPage:!1},r.pageNumberMappingData=[],r}return Object(r.a)(a,[{key:"componentDidMount",value:function(){var e=this,t=this.props,a=t.isCiteContent,n=t.showPrintPageNav;this.pxePageBreakLoadedSubscription=l.a.on("pxeFramePageBreaksLoaded",p.a.debounce((function(t){return e.onPageBreaksLoaded(t,!0)}))),this.citePageBreakLoadedSubscription=l.a.on("pageNumberLoaded",p.a.debounce(this.onPageBreaksLoaded)),this.citePageBreakNotLoadedSubscription=l.a.on("citePageNumberNotLoaded",p.a.debounce(this.onPageBreaksLoaded)),this.citeScrollSubscription=l.a.on("CitePageBreakScrollEvent",p.a.debounce(this.onPageBreaksLoaded)),(n||a)&&this.fetchPrintPageData()}},{key:"componentDidUpdate",value:function(e,t){var a=this.props,n=a.currentPageId,r=a.isDoublePage,i=a.showPrintPageNav,o=this.state.showGoToPage;n===e.currentPageId&&r===e.isDoublePage||this.updatePrintPageNumber(t.printPageValue,this.state.printPageValue),i!==e.showPrintPageNav&&i&&!o&&this.fetchPrintPageData(!0)}},{key:"componentWillUnmount",value:function(){this.pxePageBreakLoadedSubscription&&this.pxePageBreakLoadedSubscription(),this.citePageBreakLoadedSubscription&&this.citePageBreakLoadedSubscription(),this.citePageBreakNotLoadedSubscription&&this.citePageBreakNotLoadedSubscription(),this.citeScrollSubscription&&this.citeScrollSubscription()}},{key:"render",value:function(){var e,t,a=this.props,n=a.bookmarkIconData,r=a.currentPageId,i=a.hideBookmark,o=a.isDoublePage,g=a.isYoungLearner,s=a.leftPanel,l=a.pagePlaylist,c=this.state.showGoToPage,p=this.getCurrentPageIndex(r),P=0===p;l&&l.length&&(e=o&&l.length%2==0?2:1,t=p===l.length-e);var d=o?2:1,f=l[p-d]?l[p-d].title:"",m=l[p+d]?l[p+d].title:"";return u.a.createElement(x,{bookmarkData:n,isFirstPage:P,isLastPage:t,isYoungLearner:g,leftPanel:s,nextTitle:m,onChange:this.handleChange,onBlur:this.handleBlur,onFocus:this.handleFocus,onKeyDown:this.goToPage,onPageRequestCallback:this.onPageClick,prevTitle:f,showBookmark:!i,showGoToPage:c,value:this.state.printPageValue})}}]),a}(g.PureComponent);S.defaultProps={bookmarkIconData:{},goToPrintPageCallback:function(){},hideBookmark:!1,isCiteContent:!1,isDoublePage:!1,isMultiplePrintPageNoAvailable:!1,isPdfContent:!1,isPxeContent:!1,isYoungLearner:!1,leftPanel:{},pagePlaylist:[],pageNumbers:{},printPageNumberPlugin:{},showPrintPageNav:!1};t.default=S}}]);